# Hourly
Hourly Timesheet Reporting is an API that is intended to serve financial reporting services and machine-learning predictions to 
the user that benefits cost-optimization, scheduling, and increased workload productivity of small businesses.

# Getting Started

## Pre-requisites
The following actions will be necessary to successfully configure your development environment:

  * Latest version of python and pip3 installed
  * Latest version of Node.js installed
  * (Recommended) venv created within root project directory
  
From ```autogen``` directory:
  - run ```npm install```
  - run ```npm run setup```

This will leverage setuptools to be able to utilize models generated by OpenAPI-Generator-CLI as well as ensuring
all dependencies have been installed and configured.

## Structure of the Cloud
This is a Flask application wrapped in a library called Connexion, which maps an OpenAPI 3.x spec to controllers
in the domains module. Each domain follows the general structure of ```controllers/services/tests```. In general,
the OpenAPI specification and provided tooling will generate most things such as models and SQLAlchemy schemas to a 
degree of specificity that is comparable to handwritten code. For more information, consult the respective documentation:

* [Connexion](https://connexion.readthedocs.io/en/latest/)
* [OpenAlchemy](https://openapi-sqlalchemy.readthedocs.io/en/latest/)


### Entities
Below is a list of each entity that exists within the Hourly cloud as well as a brief description of its
function:

* Clockins: A representation of a block of time that an employee has worked.
* Companies: Groups of users that hold data that is unique to that group.
* Departments: Subsections of companies that divide users into a function
* Employees: Users that exist within the database.
* Packages: Templates for event types
* Events: Instantiations of packages that contain unique metadata

### Security
This app uses JWT-based authentication using a secret key listed in the environment variables. This secret key should be 
rotated roughly every 30-60 days. Additionally, the system uses role-based-access-control to ensure data sovereignty.

### Development
Development process is streamlined using the npm package ```openapi-generator-cli```. When you need to generate
models for use with services or controllers, run 

```commandline
npm run openapi-server-run-all
```

The output is autogen/server/release which contains the auto generated models. This will also automatically generate
SQLAlchemy schemas which can be used in services.

### Deployment
After ensuring all unit tests are run and have passed, run:

```commandline
npm run deploy:{profile}
```

where {profile} represents the target environment ("dev" or "prod").

### Error Handling
This project utilizes Flask's error handling capabilities to streamline the process of handling various errors
within the application. Any exception that occurs within the application is returned to the user in
the response as a streamlined dict for ease of error-handling within the frontend.

Within the exception directory, there is an HourlyException class that you may raise. The constructor
takes the error code as an argument. You will find the mapping of error codes to error code metadata 
within the exception directory.